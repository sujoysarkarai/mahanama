from refined.data_types.base_types import Span
from refined.inference.processor import Refined

refined = Refined.from_pretrained(model_name='wikipedia_model_with_numbers',
                                  entity_set='wikipedia',
                                  use_precomputed_descriptions=False)


# # Difficult disambiguation example
# text = 'saMjaya uvAca rAjan saMgrAmamAScaryaM SfRu kIrtayato mama .	kurURA pARqavAnAM ca yaTA yudDamavartata ..'
# spans = refined.process_text(text)
# print('\n' + '****' * 10 + '\n')
# print(text)
# print(spans)
# print('\n' + '****' * 10 + '\n')

# Difficult disambiguation example
text = "मार्कण्डेय उवाच अथ मद्राधिपो राजा नारदेन समागतः । उपविष्टः सभामध्ये कथायोगेन भारत ।। ततोऽभिगम्य तीर्थानि सर्वाण्येवाश्रमांस्तथा । आजगाम पितुर्वेश्म सावित्री सह मन्त्रिभिः ।। नारदेन सहासीनं सा दृष्ट्वा पितरं शुभा । उभयोरेव शिरसा चक्रे पादाभिवादनम् ।। नारद उवाच क्व गदाभूत् सुतेयं ते कुतश्चैवागता नृप । किमर्थं युवती भत्रे न चैनां सम्प्रयच्छसि ।। अश्वपतिरुवाच कार्येण खल्वनेनैव प्रेषितायैव चागता । एतस्याः शृणु देवर्षे भर्तारं योऽनया वृतः ।। मार्कण्डेय उवाच सा ब्रूहि विस्तरेणेति पित्रा संचोदिता शुभा । तदैव तस्य वचनं प्रतिगृह्येदमब्रवीत् ।। सावित्र्युवाच आसीच्छाल्वेषु धर्मात्मा क्षत्रियः पृथिवीपतिः । धुमत्सेन इति ख्यातः पश्चाच्चान्धो बभूव ह ।। विनष्टचक्षुषस्तस्य बालपुत्रस्य धीमतः । सामीप्येन हृतं राज्यं छिद्रेऽस्मिन् पूर्ववैरिणा ।। स बालवत्सया साधु भार्यया प्रस्थितो वनम् । महारण्यं गतश्चापि तपस्तेपे महाव्रतः ।। तस्य पुत्र पुरे जातः संवृद्धश्च तपोवने । सत्यवाननुरूपो मे भर्तेति मनसा वृतः ।। नारद उवाच अहो बत महत् पापं सावित्र्या नृपते कृतम् । अजानन्त्या यदनया गुणवान् सत्यवान् वृतः ।। सत्यं वदत्यस्य पिता सत्यं माता प्रभाषते । तथास्य ब्राह्मणाश्चक्रुर्नामैतत् सत्यवानिति ।। बालस्याश्वाः प्रियाश्चास्य करोत्यश्वांश्च मृन्मयान् । चित्रेऽपि विलिखत्यश्वांश्चित्राश्व इति चोच्यते ।। राजोवाच अपीदानी स तेजस्वी बुद्धिमान् वा नृपात्मजः । क्षमावानपि वा शूरः सत्यवान् पितृवत्सलः ।। नारद उवाच विवस्वानिव तेजस्वी बृहस्पतिसमो मतौ । महेन्द्र इव वीस्थ वसुधेव समन्वितः ।। अश्वपतिरुवाच अपि राजात्मजो दाता ब्रह्मण्यश्चापि सत्यवान् । रूपवानप्युदारो वाप्यथवा प्रियदर्शनः ।। नारद उवाच सांकृते रन्तिदेवस्य स्वशक्त्या दानतः समः । ब्रह्मण्यः सत्यवादी न शिबिरौशीनरो यथा ।। ययातिरिव चोदारः सोमवत् प्रियदर्शनः । रूपेणान्यतमोऽश्विभ्यां धुमत्सेनसुतो बली ।। स दान्तः स मृदुः शूरः स सत्यः संयतेन्द्रियः । स मैत्रः सोऽनसूयश्च स ह्रीमान् द्युतिमांश्च सः ।। नित्यशश्चार्जवं तस्मिन् स्थितिस्तस्यैव च ध्रुवा । संक्षेपतस्तपोवृद्धैः शीलवृद्धश्च कथ्यते ।। अश्वपतिरुवाच गुणैरुपेतं सर्वैस्तं भगवन् प्रब्रवीषि मे । दोषानष्यस्य मे ब्रूहि यदि सन्तीह केचन ।। नारद उवाच एक एवास्य दोषो हि गुणानाक्रम्य तिष्ठति । स च दोषः प्रयत्नेन न शक्यमतिवर्तितुम् ।। एको दोषोऽस्ति नान्योऽस्य सोऽद्यप्रभृति सत्यवान् । संवत्सरेण क्षीणायुहन्यासं करिष्यति ।। राजोवाच एहि सावित्रि गच्छस्व अन्यं वरय शोभने । तस्य दोषो महानेको गुणानाक्रम्य च स्थितः ।। यथा मे भगवानाह नारदो देवस्तकृतः । संवत्सरेण सोऽल्पायुहन्यासं करिष्यति ।। सावित्र्युवाच सकृदंशो निपतति सकृत् कन्या प्रदीयते । सकृदाह ददानीति त्रीण्येतानि सकृत् सकृत् ।। दीर्घायुरथवाल्पायुः सगुणो निर्गुणोऽपि वा । सकृद् वृतो मया भर्ता न द्वितीयं वृणोम्यहम् ।। मनसा निश्चयं कृत्वा ततो वाचाभिधीयते । क्रियते कर्मणा पश्चात् प्रमाणं मे मनस्ततः ।। नारद उवाच स्थिरा बुद्धिर्नरश्रेष्ठ सावित्र्या दुहितुस्तव । नैष वारयितुं शक्या धर्मादस्मात् कथंचन ।। नान्यस्मिन् पुरुषे सन्ति ये सत्यवति वै गुणाः । प्रदानमेव तस्मान्मे रोचते दुहितुस्तव ।। राजोवाच अविचाल्यं तदुक्तं यत् तथ्यं भगवता वचः । करिष्याम्येतदेवं च गुरुर्हि भगवान् मम ।। नारद उवाच अविघ्नमस्तु सावित्र्याः प्रदाने दुहितुस्तव । साधयिष्याम्यहं तावत् सर्वेषां भद्रमस्तु वः ।। मार्कण्डेय उवाच एवमुक्त्वा समुत्पत्य नारदस्त्रिदिवं गतः । राजापि दुहितुः सज्जं वैवाहिकमकारयत् ।।"
spans = refined.process_text(text)
print('\n' + '****' * 10 + '\n')
print(text)
print(spans)
print('\n' + '****' * 10 + '\n')


# text = "saMjaya uvAca rAjan SatasahasrARi tatra tatra padAtinAm . nirmaryAdaM prayudDAni tat te vakzyAmi BArata .. na putraH pitaraM jajYe pitA vA putramOrasam . na BrAtA BrAtaraM tatra svasrIyaM na ca mAtulaH .. na mAtulaM ca svasrIyo na saKAyaM saKA taTA . AvizwA iva yudDayante pARqavAH kuruBiH saha .. sTAnIkaM naravyAGrAH kecidaByapatana raTEH . aBajyanta yugEreva yugAni BaratarzaBa .. raTezASca raTezABiH kUbarA raTakUbarEH . saMgatEH sahitAH kecit parasparajiGAMsavaH .. na SekuScalituM kecit saMnipatya sTA raTEH . praBinnAstu mahAkAyaH saMnipatya gajA gajEH .. bahuDAdArayan krudDA vizAREritaretaram . satoraRapatAkESa vAraRA varavAraREH .. aBisftya mahArAja vegavadBirmahAgajEH . dantEraBihatAstatra cukruSuH paramAturAH .. aBinItASca SikzABistotrAMkuSasamAhatAH . apraBinnAH praBinnAnAM sammuKABimuKA yayuH .. praBinnErapi saMsaktAH kecit tatra mahAgajAH . krOYcavanninadaM kftvA durduvuH sarvato diSam .. samyak praRItA nAgASca praBinnakarawAmuKAH . fzwitomaranArAcErnirvidDA varavAraRAH .. praRedurBinnamarmARo nipetuSca gatAsavaH . prAdravanta diSaH kecinnadanto BEravAn ravAn . gajAnAM pAdarakzAstu vyUQoraskAH prahAriRaH . fzwiBiSca DanurBiSca vimalESca paraSvaDEH .. gadABirmusalEScEva BindipAlEH satomarEH . AyasEH paripEScEva nistriMSEvimalEH SitEH .. pragfhItEH susaMrabDA dravamARAstatastataH . vyadfSyanta mahArAja parasparajiGAMsavaH .. rAjamAnASca nistriMSAH saMsiktA naraSoRitEH . pratyadfSyanta SUrARAmanyonmaBiDAvatAm .. avakziptAvaDUtAnAmasInAM vIrabAhuBiH . saMjajYe tumulaH SabdaH patatAM paramarmasu .. gadAmusalarugRAnAM BinnAnAM ca varAsiBiH . dantidantAvaBinnAnAM mfditAnAM ca dantiBiH .. tatra tatra narOGARAM kroSatAmitaretaram . SuSruvurdAruRA vAcaH pretAnAmiva BArata .. hayErapi hayArohAScAmarApIqaDAriBiH . haMsEriva mahAvegEranyonyamaBividrutAH .. tEvimuktA mahAprAsA jAmbUnadaviBUzaRAH . ASugA vimalAstIkzRAH sampeturBujagopamAH .. aSvEracyajavEH kecidAplutya mahato sTAn . SirAMsyAdadire vIrA raTinAmaSvasAdinaH .. bahUnapi hayArohAn BallEH saMnataparvaBiH . raTI jaGAna samprApya bARagocaramAgatAn .. navameGapratIkASAScAkzipya turagAn gajAH . pAdEreva vimfdnanti mattAH kanakaBUzaRAH .. pAwyamAnezu kumBezu pArSvezvapi ca vAraRAH . prAsErvinihatAH kecid vineduH paramAturAH .. sASvArohAn hayAn kAMScidunmaTya varavAraRAH . sahasA cikzipustatra saMkule BErave sati .. sASvArohAn vizARAprEkzipya turagAn gajAH . raTOGAnaBimfdnantaH saDvajAnaBicakramuH .. puMstvAdatimadatvAcca kecit tatra mahAgajAH . sASvArohAn hayAYjaGnuH karEH sacaraREstaTA .. aSvArohESca samare hastisAdiBireva ca . pratimAnezu gAtrezu pArSvezvaBi ca vAraRAn . ASugA vimalAstIkzRAH sampeturBujagopamAH .. narASvakAyAn nirBidya lOhAni kavacAni ca . nipeturvimalAH Saktyo vIrabAhuBirarpitAH .. maholkApratimA GorAstatra tatra viSAmpate . dvIpicarmAvanadDESca vyAGracarmacCadErapi .. vikoSEvimalEH KaNgEraBijagmuH parAn raRe . aBiplutamaBikrudDamekapAvidAritam .. vidarSayantaH sampetuH KagacarmaparaSvaDEH . kecidAkzipya kariRaH SASvAnapi raTAn karEH .. vikarzanto diSaH sarvAH sampetuH sarvaSabdagAH . SaNkuBirdAritAH kecit samBinnASca paraSvaDEH .. hastiBirmuditAH kecit kzuRRAScAnye turaMgamEH . raTaneminikfttASca nikfttASca paraSvaDEH .. vyAkroSanta narA rAjaMstatra tatra sma bAnDavAn . putrAnanye pitfnanye BrAtfSca saha banDuBiH .. mAtulAn BAgineyAMSca parAnapi ca saMyuge . vikIrRAntrAH subahavo BagnasakTASca BArata .. bAhuBiScApare CinnEH pArTezu ca vidAritAH . krandantaH samadfSyanta tfzitA jIvitepsavaH .. tfzA parigatAH kecidalpasattvA viSAmpate . BUmO nipatitAH saMKye mfgayAMcakrire jalam .. ruDirOGapariklinnAH kliSyamAnASca BArata . vyanindana BfSamAtmAnaM tava putrAMSca saMgatAn .. apare kzatriyAH SUrAH kftavErAH parasparam . nEva SastraM vimuYcanti nEva krandanti mAriza .. tarjayanti ca saMhfzwAstatra tatra parasparam . AdaSya daSanEScApi kroDAt saradanacCadam .. BfkuwIkuwilErvaktrEH prekzanti ca parasparam . apare kliSyamAnAstu SarArtA vraRapIqitAH .. nizkUjAH samapadyanta dfQasattvA mahAbalAH . anye ca visTAH SUrA sTamanyasya saMyuge . prArTayAnA nipatitAH saMkzuRRA varavAraREH . aSoBanta mahArAja sapuzpA iva kiMSukAH .. sambaBUvuranIkezu bahavo BEravasvanAH . vartamAne mahABIme tasmin vIravarakzaye . nijaGAna pitA putraM putraSca pitaraM raRe . svasrIyo mAtulaM cApi svasrIyaM cApi mAtulaH .. saKA saKAyaM ca taTA sambanDI bAnDavaM taTA . evaM yuyuDire tatra kuravaH pARqavEH saha .. vartamAne taTA tasmin nirmaryAde BayAnake . BIzmamAsAdya pArTAnAM vAhinI samakampata .. ketunA paYcatAreRa tAlena BaratarzaBa . rAjatena mahAbAhurucCritena mahAraTe . baBO BIzmastadA rAjaScandramA iva meruRA .."

# spans = refined.process_text(text)
# print('\n' + '****' * 10 + '\n')
# print(text)
# print(spans)
# print('\n' + '****' * 10 + '\n')

# '''
# [{"uri": "saYjaya", "surface_form": "saYjaya", "start": 0, "end": 7, "qcode": "Q9460"}, {"uri": "pARqava", "surface_form": "pARqava", "start": 273, "end": 280, "qcode": "Q7969"}, {"uri": "kuru", "surface_form": "kuru", "start": 282, "end": 286, "qcode": "Q6239"}, {"uri": "DftarAzwra", "surface_form": "BaratarzaBa", "start": 369, "end": 380, "qcode": "Q3508"}, {"uri": "preta", "surface_form": "preta", "start": 1680, "end": 1685, "qcode": "Q8665"}, {"uri": "DftarAzwra", "surface_form": "BArata", "start": 1692, "end": 1698, "qcode": "Q3508"}, {"uri": "kuru", "surface_form": "kuru", "start": 4300, "end": 4304, "qcode": "Q6239"}, {"uri": "pARqava", "surface_form": "pARqava", "start": 4308, "end": 4315, "qcode": "Q7969"}, {"uri": "BIzma", "surface_form": "BIzma", "start": 4369, "end": 4374, "qcode": "Q1497"}, {"uri": "pArTa", "surface_form": "pArTa", "start": 4382, "end": 4387, "qcode": "Q8185"}, {"uri": "DftarAzwra", "surface_form": "BaratarzaBa", "start": 4439, "end": 4450, "qcode": "Q3508"}, {"uri": "BIzma", "surface_form": "BIzma", "start": 4497, "end": 4502, "qcode": "Q1497"}, {"uri": "meru", "surface_form": "meru", "start": 4526, "end": 4530, "qcode": "Q7300"}]
# '''